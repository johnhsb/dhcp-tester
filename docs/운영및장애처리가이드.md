# DHCP ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì†”ë£¨ì…˜ ìš´ì˜ ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ìš´ì˜ ê°€ì´ë“œ](#1-ìš´ì˜-ê°€ì´ë“œ)
2. [ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼](#2-ëª¨ë‹ˆí„°ë§-ë°-ì•Œë¦¼)
3. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#3-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
4. [ì„±ëŠ¥ ìµœì í™”](#4-ì„±ëŠ¥-ìµœì í™”)
5. [ë³´ì•ˆ ìš´ì˜](#5-ë³´ì•ˆ-ìš´ì˜)
6. [ë°±ì—… ë° ë³µêµ¬](#6-ë°±ì—…-ë°-ë³µêµ¬)
7. [ìš´ì˜ ìë™í™”](#7-ìš´ì˜-ìë™í™”)

## 1. ìš´ì˜ ê°€ì´ë“œ

### 1.1 ì¼ìƒ ìš´ì˜ ì ˆì°¨

#### ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
```bash
#!/bin/bash
# scripts/daily-check.sh

echo "=== DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì¼ì¼ ì ê²€ ==="
echo "ì ê²€ ì‹œê°„: $(date)"

# 1. ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸
echo -e "\nğŸ” ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í˜„í™©:"
echo "CPU ì‚¬ìš©ë¥ : $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"
echo "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : $(free | grep Mem | awk '{printf("%.1f%%\n", $3/$2 * 100.0)}')"
echo "ë””ìŠ¤í¬ ì‚¬ìš©ë¥ : $(df -h / | tail -1 | awk '{print $5}')"

# 2. í”„ë¡œì„¸ìŠ¤ ìƒíƒœ í™•ì¸
echo -e "\nğŸ“Š í”„ë¡œì„¸ìŠ¤ ìƒíƒœ:"
if pgrep -f dhcp-server > /dev/null; then
    echo "âœ… DHCP ì„œë²„: ì‹¤í–‰ ì¤‘ (PID: $(pgrep -f dhcp-server))"
    # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
    MEMORY_USAGE=$(ps -p $(pgrep -f dhcp-server) -o rss= | awk '{print $1/1024}')
    echo "   ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${MEMORY_USAGE}MB"
else
    echo "âŒ DHCP ì„œë²„: ì¤‘ì§€ë¨"
fi

# 3. ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ í™•ì¸
echo -e "\nğŸŒ ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ ìƒíƒœ:"
if netstat -ulnp | grep :67 > /dev/null; then
    echo "âœ… DHCP ì„œë²„ í¬íŠ¸ (67/UDP): ë°”ì¸ë”©ë¨"
else
    echo "âŒ DHCP ì„œë²„ í¬íŠ¸ (67/UDP): ë°”ì¸ë”© ì•ˆë¨"
fi

# 4. ë¡œê·¸ íŒŒì¼ í¬ê¸° í™•ì¸
echo -e "\nğŸ“ ë¡œê·¸ íŒŒì¼ ìƒíƒœ:"
LOG_DIR="/var/log/dhcp-test"
if [ -d "$LOG_DIR" ]; then
    for log_file in "$LOG_DIR"/*.log; do
        if [ -f "$log_file" ]; then
            SIZE=$(du -h "$log_file" | cut -f1)
            echo "   $(basename "$log_file"): $SIZE"
        fi
    done
else
    echo "   ë¡œê·¸ ë””ë ‰í† ë¦¬ ì—†ìŒ: $LOG_DIR"
fi

# 5. ìµœê·¼ ì—ëŸ¬ í™•ì¸
echo -e "\nâš ï¸ ìµœê·¼ 24ì‹œê°„ ì—ëŸ¬ (ìµœëŒ€ 5ê°œ):"
if [ -f "/var/log/dhcp-test/server-error.log" ]; then
    tail -n 100 /var/log/dhcp-test/server-error.log | \
    grep "$(date -d '1 day ago' '+%Y-%m-%d')\|$(date '+%Y-%m-%d')" | \
    tail -n 5
else
    echo "   ì—ëŸ¬ ë¡œê·¸ íŒŒì¼ ì—†ìŒ"
fi

# 6. ë””ìŠ¤í¬ ê³µê°„ ê²½ê³ 
DISK_USAGE=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
if [ "$DISK_USAGE" -gt 85 ]; then
    echo -e "\nğŸš¨ ê²½ê³ : ë””ìŠ¤í¬ ì‚¬ìš©ë¥ ì´ 85%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤ ($DISK_USAGE%)"
fi

echo -e "\n=== ì¼ì¼ ì ê²€ ì™„ë£Œ ==="
```

#### ì£¼ê°„ ì ê²€ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# scripts/weekly-check.sh

echo "=== DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì£¼ê°„ ì ê²€ ==="

# 1. ë¡œê·¸ ë¶„ì„
echo "ğŸ“Š ì£¼ê°„ í†µê³„ ë¶„ì„ (ìµœê·¼ 7ì¼):"

# ì—ëŸ¬ íŒ¨í„´ ë¶„ì„
echo -e "\nì—ëŸ¬ ë°œìƒ ë¹ˆë„:"
grep -h "ERROR\|FAIL\|timeout" /var/log/dhcp-test/*.log 2>/dev/null | \
awk '{print $1}' | sort | uniq -c | sort -nr | head -10

# ì„±ëŠ¥ íŠ¸ë Œë“œ ë¶„ì„
echo -e "\nì„±ëŠ¥ íŠ¸ë Œë“œ:"
grep "ì„±ê³µë¥ :" /var/log/dhcp-test/tester*.log 2>/dev/null | \
tail -n 20 | awk '{print $1, $NF}' | \
awk '{sum += $2; count++} END {if(count>0) print "í‰ê·  ì„±ê³µë¥ :", sum/count "%"}'

# 2. ì‹œìŠ¤í…œ í—¬ìŠ¤ ì²´í¬
echo -e "\nğŸ¥ ì‹œìŠ¤í…œ í—¬ìŠ¤ ì²´í¬:"
./scripts/health-check.sh

# 3. ë³´ì•ˆ ì ê²€
echo -e "\nğŸ” ë³´ì•ˆ ì ê²€:"
# ë¡œê·¸ì¸ ì‹œë„ í™•ì¸
echo "ìµœê·¼ ë¡œê·¸ì¸ ì‹œë„:"
last -n 10 | grep -v "reboot\|wtmp"

# ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
echo -e "\nDHCP ê´€ë ¨ í”„ë¡œì„¸ìŠ¤:"
ps aux | grep -E "dhcp|67|68" | grep -v grep

# 4. ìš©ëŸ‰ ì •ë¦¬ ê¶Œì¥ì‚¬í•­
echo -e "\nğŸ§¹ ì •ë¦¬ ê¶Œì¥ì‚¬í•­:"
find /var/log/dhcp-test -name "*.log" -mtime +30 -exec ls -lh {} \; | \
head -5 | awk '{print "30ì¼ ì´ìƒ ëœ ë¡œê·¸:", $9, "("$5")"}'

echo -e "\n=== ì£¼ê°„ ì ê²€ ì™„ë£Œ ==="
```

### 1.2 ì„œë¹„ìŠ¤ ê´€ë¦¬

#### systemd ì„œë¹„ìŠ¤ ê´€ë¦¬
```bash
# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
sudo systemctl status dhcp-test-server

# ì„œë¹„ìŠ¤ ì‹œì‘/ì¤‘ì§€/ì¬ì‹œì‘
sudo systemctl start dhcp-test-server
sudo systemctl stop dhcp-test-server
sudo systemctl restart dhcp-test-server

# ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
sudo journalctl -u dhcp-test-server -f --since "1 hour ago"

# ì„¤ì • ë¦¬ë¡œë“œ
sudo systemctl reload dhcp-test-server

# ë¶€íŒ… ì‹œ ìë™ ì‹œì‘ ì„¤ì •
sudo systemctl enable dhcp-test-server
```

#### í”„ë¡œì„¸ìŠ¤ ëª¨ë‹ˆí„°ë§
```bash
#!/bin/bash
# scripts/process-monitor.sh

PROCESS_NAME="dhcp-server"
MAX_MEMORY_MB=2048  # 2GB
MAX_CPU_PERCENT=80

# í”„ë¡œì„¸ìŠ¤ ì°¾ê¸°
PID=$(pgrep -f "$PROCESS_NAME")

if [ -z "$PID" ]; then
    echo "âŒ $PROCESS_NAME í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    exit 1
fi

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
MEMORY_MB=$(ps -p "$PID" -o rss= | awk '{print int($1/1024)}')
CPU_PERCENT=$(ps -p "$PID" -o %cpu= | awk '{print int($1)}')

echo "ğŸ“Š $PROCESS_NAME ëª¨ë‹ˆí„°ë§ (PID: $PID)"
echo "ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${MEMORY_MB}MB / ${MAX_MEMORY_MB}MB"
echo "CPU ì‚¬ìš©ë¥ : ${CPU_PERCENT}% / ${MAX_CPU_PERCENT}%"

# ì„ê³„ì¹˜ í™•ì¸
if [ "$MEMORY_MB" -gt "$MAX_MEMORY_MB" ]; then
    echo "ğŸš¨ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì„ê³„ì¹˜ ì´ˆê³¼!"
    # ì•Œë¦¼ ë°œì†¡ (ì„ íƒì )
    # send_alert "Memory threshold exceeded: ${MEMORY_MB}MB"
fi

if [ "$CPU_PERCENT" -gt "$MAX_CPU_PERCENT" ]; then
    echo "ğŸš¨ CPU ì‚¬ìš©ë¥  ì„ê³„ì¹˜ ì´ˆê³¼!"
    # ì•Œë¦¼ ë°œì†¡ (ì„ íƒì )
    # send_alert "CPU threshold exceeded: ${CPU_PERCENT}%"
fi

# ìƒì„¸ í”„ë¡œì„¸ìŠ¤ ì •ë³´
echo -e "\nìƒì„¸ ì •ë³´:"
ps -p "$PID" -o pid,ppid,user,%cpu,%mem,etime,cmd
```

### 1.3 ë¡œê·¸ ê´€ë¦¬

#### ë¡œê·¸ ë¡œí…Œì´ì…˜ ì„¤ì •
```bash
# /etc/logrotate.d/dhcp-test
/var/log/dhcp-test/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
    su dhcp-test dhcp-test
    postrotate
        # ë¡œê·¸ ë¡œí…Œì´ì…˜ í›„ ì„œë¹„ìŠ¤ì— ì‹œê·¸ë„ ì „ì†¡ (ì„ íƒì )
        /bin/kill -HUP $(cat /var/run/dhcp-server.pid 2>/dev/null) 2>/dev/null || true
    endscript
}
```

#### ë¡œê·¸ ë¶„ì„ ë„êµ¬
```bash
#!/bin/bash
# scripts/log-analyzer.sh

LOG_FILE="${1:-/var/log/dhcp-test/server.log}"
TIME_RANGE="${2:-1 hour ago}"

echo "=== DHCP ë¡œê·¸ ë¶„ì„ ==="
echo "íŒŒì¼: $LOG_FILE"
echo "ì‹œê°„ ë²”ìœ„: $TIME_RANGE"

if [ ! -f "$LOG_FILE" ]; then
    echo "âŒ ë¡œê·¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: $LOG_FILE"
    exit 1
fi

# 1. ê¸°ë³¸ í†µê³„
echo -e "\nğŸ“Š ê¸°ë³¸ í†µê³„:"
TOTAL_LINES=$(wc -l < "$LOG_FILE")
echo "ì „ì²´ ë¡œê·¸ ë¼ì¸ ìˆ˜: $TOTAL_LINES"

# 2. ë©”ì‹œì§€ íƒ€ì…ë³„ í†µê³„
echo -e "\nğŸ“ˆ DHCP ë©”ì‹œì§€ íƒ€ì…ë³„ í†µê³„:"
grep -E "DISCOVER|OFFER|REQUEST|ACK|NAK" "$LOG_FILE" | \
awk '{print $NF}' | sort | uniq -c | sort -nr

# 3. ì—ëŸ¬ ë¶„ì„
echo -e "\nâŒ ì—ëŸ¬ ë¶„ì„:"
grep -i "error\|fail\|timeout" "$LOG_FILE" | \
awk '{print $1, $2, $NF}' | sort | uniq -c | sort -nr | head -10

# 4. í´ë¼ì´ì–¸íŠ¸ IP í†µê³„
echo -e "\nğŸŒ í´ë¼ì´ì–¸íŠ¸ IP ë¶„í¬:"
grep -oE "([0-9]{1,3}\.){3}[0-9]{1,3}" "$LOG_FILE" | \
sort | uniq -c | sort -nr | head -10

# 5. ì‹œê°„ëŒ€ë³„ í™œë™
echo -e "\nâ° ì‹œê°„ëŒ€ë³„ í™œë™:"
awk '{print substr($2,1,2)}' "$LOG_FILE" | sort | uniq -c | \
awk '{printf("%sì‹œ: %dê±´\n", $2, $1)}'

# 6. ìµœê·¼ ì—ëŸ¬ (ìƒì„¸)
echo -e "\nğŸ” ìµœê·¼ ì—ëŸ¬ (ìƒì„¸):"
grep -i "error\|fail" "$LOG_FILE" | tail -5
```

## 2. ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

### 2.1 ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

#### ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# scripts/dashboard.sh

# í„°ë¯¸ë„ ì œì–´
clear_screen() { printf '\033[2J\033[H'; }
hide_cursor() { printf '\033[?25l'; }
show_cursor() { printf '\033[?25h'; }
color_red() { printf '\033[31m'; }
color_green() { printf '\033[32m'; }
color_yellow() { printf '\033[33m'; }
color_blue() { printf '\033[34m'; }
color_reset() { printf '\033[0m'; }

# ì‹œê·¸ë„ í•¸ë“¤ëŸ¬
cleanup() {
    show_cursor
    color_reset
    echo -e "\nëª¨ë‹ˆí„°ë§ ì¢…ë£Œë¨"
    exit 0
}
trap cleanup SIGINT SIGTERM

# ë©”ì¸ ëŒ€ì‹œë³´ë“œ
show_dashboard() {
    clear_screen
    hide_cursor
    
    # í—¤ë”
    color_blue
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                    DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ                    â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    color_reset
    
    # ì‹œìŠ¤í…œ ìƒíƒœ
    echo -e "\nğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ ($(date '+%Y-%m-%d %H:%M:%S'))"
    echo "----------------------------------------"
    
    # CPU ë° ë©”ëª¨ë¦¬
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    MEMORY_USAGE=$(free | grep Mem | awk '{printf("%.1f", $3/$2 * 100.0)}')
    
    printf "CPU ì‚¬ìš©ë¥ :    "
    if (( $(echo "$CPU_USAGE > 80" | bc -l) )); then
        color_red; printf "%s%%\n" "$CPU_USAGE"; color_reset
    elif (( $(echo "$CPU_USAGE > 60" | bc -l) )); then
        color_yellow; printf "%s%%\n" "$CPU_USAGE"; color_reset
    else
        color_green; printf "%s%%\n" "$CPU_USAGE"; color_reset
    fi
    
    printf "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : "
    if (( $(echo "$MEMORY_USAGE > 80" | bc -l) )); then
        color_red; printf "%s%%\n" "$MEMORY_USAGE"; color_reset
    else
        color_green; printf "%s%%\n" "$MEMORY_USAGE"; color_reset
    fi
    
    # í”„ë¡œì„¸ìŠ¤ ìƒíƒœ
    echo -e "\nğŸ”§ í”„ë¡œì„¸ìŠ¤ ìƒíƒœ"
    echo "----------------------------------------"
    
    if pgrep -f dhcp-server > /dev/null; then
        PID=$(pgrep -f dhcp-server)
        PROC_MEMORY=$(ps -p "$PID" -o rss= | awk '{print int($1/1024)}')
        PROC_CPU=$(ps -p "$PID" -o %cpu= | awk '{print $1}')
        
        color_green
        printf "DHCP ì„œë²„:     ì‹¤í–‰ì¤‘ (PID: %s)\n" "$PID"
        color_reset
        printf "               ë©”ëª¨ë¦¬: %sMB, CPU: %s%%\n" "$PROC_MEMORY" "$PROC_CPU"
    else
        color_red
        echo "DHCP ì„œë²„:     ì¤‘ì§€ë¨"
        color_reset
    fi
    
    # ë„¤íŠ¸ì›Œí¬ ìƒíƒœ
    echo -e "\nğŸŒ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ"
    echo "----------------------------------------"
    
    if netstat -ulnp | grep :67 > /dev/null 2>&1; then
        color_green; echo "í¬íŠ¸ 67/UDP:   ë°”ì¸ë”©ë¨"; color_reset
    else
        color_red; echo "í¬íŠ¸ 67/UDP:   ë°”ì¸ë”© ì•ˆë¨"; color_reset
    fi
    
    # ìµœê·¼ í™œë™
    echo -e "\nğŸ“ˆ ìµœê·¼ í™œë™ (ìµœê·¼ 1ë¶„)"
    echo "----------------------------------------"
    
    if [ -f "/var/log/dhcp-test/server.log" ]; then
        RECENT_DISCOVER=$(grep "$(date '+%Y-%m-%d %H:%M')" /var/log/dhcp-test/server.log 2>/dev/null | grep -c "DISCOVER" || echo "0")
        RECENT_REQUEST=$(grep "$(date '+%Y-%m-%d %H:%M')" /var/log/dhcp-test/server.log 2>/dev/null | grep -c "REQUEST" || echo "0")
        
        echo "DISCOVER ìˆ˜ì‹ : $RECENT_DISCOVER"
        echo "REQUEST ìˆ˜ì‹ :  $RECENT_REQUEST"
    else
        color_yellow; echo "ë¡œê·¸ íŒŒì¼ ì—†ìŒ"; color_reset
    fi
    
    # í•˜ë‹¨ ì•ˆë‚´
    echo -e "\n\n"
    color_blue
    echo "[Ctrl+Cë¡œ ì¢…ë£Œ]                                    [ìë™ ê°±ì‹ : 5ì´ˆ]"
    color_reset
}

# ë©”ì¸ ë£¨í”„
echo "DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ì‹œì‘..."
while true; do
    show_dashboard
    sleep 5
done
```

### 2.2 ì•Œë¦¼ ì‹œìŠ¤í…œ

#### ì´ë©”ì¼ ì•Œë¦¼
```bash
#!/bin/bash
# scripts/email-alert.sh

SMTP_SERVER="smtp.gmail.com"
SMTP_PORT="587"
EMAIL_FROM="dhcp-monitor@company.com"
EMAIL_TO="admin@company.com"
EMAIL_SUBJECT="DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì•Œë¦¼"

send_email_alert() {
    local subject="$1"
    local message="$2"
    local priority="${3:-normal}"  # low, normal, high
    
    # ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ì œëª© ìˆ˜ì •
    case $priority in
        "high")
            subject="ğŸš¨ [ê¸´ê¸‰] $subject"
            ;;
        "low")
            subject="â„¹ï¸ [ì •ë³´] $subject"
            ;;
        *)
            subject="âš ï¸ [ê²½ê³ ] $subject"
            ;;
    esac
    
    # ë©”ì¼ ë‚´ìš© ìƒì„±
    cat << EOF > /tmp/dhcp-alert-mail.txt
From: $EMAIL_FROM
To: $EMAIL_TO
Subject: $subject
Content-Type: text/html; charset=UTF-8

<html>
<body>
<h2>DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì•Œë¦¼</h2>
<p><strong>ì‹œê°„:</strong> $(date '+%Y-%m-%d %H:%M:%S')</p>
<p><strong>í˜¸ìŠ¤íŠ¸:</strong> $(hostname)</p>
<hr>
<pre>$message</pre>
<hr>
<p><em>ì´ ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</em></p>
</body>
</html>
EOF
    
    # ë©”ì¼ ë°œì†¡ (sendmail ì‚¬ìš©)
    if command -v sendmail &> /dev/null; then
        sendmail "$EMAIL_TO" < /tmp/dhcp-alert-mail.txt
        echo "ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡ë¨: $subject"
    else
        echo "sendmailì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨."
    fi
    
    # ì„ì‹œ íŒŒì¼ ì •ë¦¬
    rm -f /tmp/dhcp-alert-mail.txt
}

# ì‚¬ìš© ì˜ˆì‹œ
# send_email_alert "DHCP ì„œë²„ ì¤‘ì§€ë¨" "DHCP ì„œë²„ê°€ ì˜ˆìƒì¹˜ ëª»í•˜ê²Œ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤." "high"
```

#### Slack ì•Œë¦¼
```bash
#!/bin/bash
# scripts/slack-alert.sh

SLACK_WEBHOOK_URL="https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
SLACK_CHANNEL="#dhcp-alerts"
SLACK_USERNAME="DHCP Monitor"

send_slack_alert() {
    local title="$1"
    local message="$2"
    local color="${3:-warning}"  # good, warning, danger
    
    # ìƒ‰ìƒ ì„¤ì •
    case $color in
        "good") color="#36a64f" ;;
        "danger") color="#ff0000" ;;
        *) color="#ff9500" ;;
    esac
    
    # Slack ë©”ì‹œì§€ í˜ì´ë¡œë“œ ìƒì„±
    local payload=$(cat << EOF
{
    "channel": "$SLACK_CHANNEL",
    "username": "$SLACK_USERNAME",
    "attachments": [
        {
            "color": "$color",
            "title": "$title",
            "text": "$message",
            "fields": [
                {
                    "title": "í˜¸ìŠ¤íŠ¸",
                    "value": "$(hostname)",
                    "short": true
                },
                {
                    "title": "ì‹œê°„",
                    "value": "$(date '+%Y-%m-%d %H:%M:%S')",
                    "short": true
                }
            ],
            "footer": "DHCP Monitor",
            "ts": $(date +%s)
        }
    ]
}
EOF
)
    
    # Slackìœ¼ë¡œ ë©”ì‹œì§€ ë°œì†¡
    if curl -X POST -H 'Content-type: application/json' \
            --data "$payload" \
            "$SLACK_WEBHOOK_URL" \
            --silent --output /dev/null; then
        echo "Slack ì•Œë¦¼ ë°œì†¡ë¨: $title"
    else
        echo "Slack ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨"
    fi
}

# ì‚¬ìš© ì˜ˆì‹œ
# send_slack_alert "DHCP ì„œë²„ ì¬ì‹œì‘ë¨" "ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤." "good"
```

### 2.3 ì„ê³„ì¹˜ ëª¨ë‹ˆí„°ë§

#### ì„ê³„ì¹˜ ê°ì‹œ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# scripts/threshold-monitor.sh

# ì„ê³„ì¹˜ ì„¤ì •
CPU_THRESHOLD=80
MEMORY_THRESHOLD=85
DISK_THRESHOLD=90
DHCP_ERROR_RATE_THRESHOLD=10  # 10% ì´ìƒ ì—ëŸ¬ìœ¨

LOG_FILE="/var/log/dhcp-test/threshold-monitor.log"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

check_system_resources() {
    # CPU ì‚¬ìš©ë¥  í™•ì¸
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1 | cut -d'.' -f1)
    if [ "$CPU_USAGE" -gt "$CPU_THRESHOLD" ]; then
        log_message "âš ï¸ CPU ì‚¬ìš©ë¥  ì„ê³„ì¹˜ ì´ˆê³¼: ${CPU_USAGE}% (ì„ê³„ì¹˜: ${CPU_THRESHOLD}%)"
        send_slack_alert "CPU ì‚¬ìš©ë¥  ê²½ê³ " "CPU ì‚¬ìš©ë¥ ì´ ${CPU_USAGE}%ì…ë‹ˆë‹¤." "warning"
    fi
    
    # ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  í™•ì¸
    MEMORY_USAGE=$(free | grep Mem | awk '{printf("%.0f", $3/$2 * 100.0)}')
    if [ "$MEMORY_USAGE" -gt "$MEMORY_THRESHOLD" ]; then
        log_message "âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ì„ê³„ì¹˜ ì´ˆê³¼: ${MEMORY_USAGE}% (ì„ê³„ì¹˜: ${MEMORY_THRESHOLD}%)"
        send_slack_alert "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ê²½ê³ " "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ${MEMORY_USAGE}%ì…ë‹ˆë‹¤." "warning"
    fi
    
    # ë””ìŠ¤í¬ ì‚¬ìš©ë¥  í™•ì¸
    DISK_USAGE=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ "$DISK_USAGE" -gt "$DISK_THRESHOLD" ]; then
        log_message "ğŸš¨ ë””ìŠ¤í¬ ì‚¬ìš©ë¥  ì„ê³„ì¹˜ ì´ˆê³¼: ${DISK_USAGE}% (ì„ê³„ì¹˜: ${DISK_THRESHOLD}%)"
        send_slack_alert "ë””ìŠ¤í¬ ê³µê°„ ê²½ê³ " "ë””ìŠ¤í¬ ì‚¬ìš©ë¥ ì´ ${DISK_USAGE}%ì…ë‹ˆë‹¤." "danger"
    fi
}

check_dhcp_performance() {
    local dhcp_log="/var/log/dhcp-test/server.log"
    
    if [ -f "$dhcp_log" ]; then
        # ìµœê·¼ 10ë¶„ê°„ì˜ ì—ëŸ¬ìœ¨ í™•ì¸
        local current_time=$(date '+%Y-%m-%d %H:%M')
        local ten_min_ago=$(date -d '10 minutes ago' '+%Y-%m-%d %H:%M')
        
        local total_requests=$(grep -E "${ten_min_ago}|${current_time}" "$dhcp_log" | grep -c "DISCOVER\|REQUEST" || echo "0")
        local error_count=$(grep -E "${ten_min_ago}|${current_time}" "$dhcp_log" | grep -c "ERROR\|FAIL\|timeout" || echo "0")
        
        if [ "$total_requests" -gt 0 ]; then
            local error_rate=$((error_count * 100 / total_requests))
            
            if [ "$error_rate" -gt "$DHCP_ERROR_RATE_THRESHOLD" ]; then
                log_message "âš ï¸ DHCP ì—ëŸ¬ìœ¨ ì„ê³„ì¹˜ ì´ˆê³¼: ${error_rate}% (${error_count}/${total_requests})"
                send_slack_alert "DHCP ì—ëŸ¬ìœ¨ ê²½ê³ " "ìµœê·¼ 10ë¶„ê°„ ì—ëŸ¬ìœ¨ì´ ${error_rate}%ì…ë‹ˆë‹¤." "warning"
            fi
        fi
    fi
}

check_process_health() {
    if ! pgrep -f dhcp-server > /dev/null; then
        log_message "ğŸš¨ DHCP ì„œë²„ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤!"
        send_slack_alert "DHCP ì„œë²„ ì¤‘ì§€" "DHCP ì„œë²„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." "danger"
        
        # ìë™ ì¬ì‹œì‘ ì‹œë„ (ì„ íƒì )
        if [ "${AUTO_RESTART:-false}" = "true" ]; then
            log_message "ìë™ ì¬ì‹œì‘ ì‹œë„ ì¤‘..."
            systemctl start dhcp-test-server
            sleep 5
            
            if pgrep -f dhcp-server > /dev/null; then
                log_message "âœ… DHCP ì„œë²„ ìë™ ì¬ì‹œì‘ ì„±ê³µ"
                send_slack_alert "DHCP ì„œë²„ ì¬ì‹œì‘" "ì„œë²„ê°€ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤." "good"
            else
                log_message "âŒ DHCP ì„œë²„ ìë™ ì¬ì‹œì‘ ì‹¤íŒ¨"
                send_slack_alert "DHCP ì„œë²„ ì¬ì‹œì‘ ì‹¤íŒ¨" "ìë™ ì¬ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤." "danger"
            fi
        fi
    fi
}

# ë©”ì¸ ëª¨ë‹ˆí„°ë§ ë£¨í”„
main() {
    log_message "=== ì„ê³„ì¹˜ ëª¨ë‹ˆí„°ë§ ì‹œì‘ ==="
    
    while true; do
        check_system_resources
        check_dhcp_performance
        check_process_health
        
        sleep 60  # 1ë¶„ë§ˆë‹¤ í™•ì¸
    done
}

# ì‹œê·¸ë„ í•¸ë“¤ëŸ¬
cleanup() {
    log_message "=== ì„ê³„ì¹˜ ëª¨ë‹ˆí„°ë§ ì¢…ë£Œ ==="
    exit 0
}
trap cleanup SIGINT SIGTERM

# ì‹¤í–‰
main "$@"
```

## 3. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 3.1 ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°

#### ì—°ê²° ê´€ë ¨ ë¬¸ì œ
```bash
#!/bin/bash
# scripts/troubleshoot-connection.sh

echo "=== DHCP ì—°ê²° ë¬¸ì œ ì§„ë‹¨ ==="

# 1. ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸
echo "ğŸ” ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ:"
ip addr show | grep -E "^[0-9]|inet "

# 2. í¬íŠ¸ ë°”ì¸ë”© í™•ì¸
echo -e "\nğŸ” í¬íŠ¸ ë°”ì¸ë”© ìƒíƒœ:"
echo "DHCP ì„œë²„ í¬íŠ¸ (67/UDP):"
netstat -ulnp | grep :67 || echo "  ë°”ì¸ë”©ë˜ì§€ ì•ŠìŒ"

echo "DHCP í´ë¼ì´ì–¸íŠ¸ í¬íŠ¸ (68/UDP):"
netstat -ulnp | grep :68 || echo "  ë°”ì¸ë”©ë˜ì§€ ì•ŠìŒ"

# 3. ë°©í™”ë²½ í™•ì¸
echo -e "\nğŸ” ë°©í™”ë²½ ìƒíƒœ:"
if command -v ufw &> /dev/null; then
    ufw status | grep -E "67|68"
elif command -v firewall-cmd &> /dev/null; then
    firewall-cmd --list-ports | grep -E "67|68"
else
    echo "  ë°©í™”ë²½ ë„êµ¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"
fi

# 4. í”„ë¡œì„¸ìŠ¤ í™•ì¸
echo -e "\nğŸ” ê´€ë ¨ í”„ë¡œì„¸ìŠ¤:"
ps aux | grep -E "dhcp|67|68" | grep -v grep

# 5. ê¶Œí•œ í™•ì¸
echo -e "\nğŸ” ê¶Œí•œ í™•ì¸:"
echo "í˜„ì¬ ì‚¬ìš©ì: $(whoami)"
if [ "$(id -u)" -eq 0 ]; then
    echo "  âœ… Root ê¶Œí•œ"
else
    echo "  âš ï¸ ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œ"
    echo "  í¬íŠ¸ 67/68 ë°”ì¸ë”©ì„ ìœ„í•´ sudo ê¶Œí•œì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
fi

# 6. í¬íŠ¸ ì—°ê²°ì„± í…ŒìŠ¤íŠ¸
echo -e "\nğŸ” í¬íŠ¸ ì—°ê²°ì„± í…ŒìŠ¤íŠ¸:"
test_port() {
    local host="$1"
    local port="$2"
    local protocol="$3"
    
    if command -v nc &> /dev/null; then
        if [ "$protocol" = "udp" ]; then
            timeout 3 nc -u -z "$host" "$port" 2>/dev/null
        else
            timeout 3 nc -z "$host" "$port" 2>/dev/null
        fi
        
        if [ $? -eq 0 ]; then
            echo "  âœ… $host:$port ($protocol) - ì—°ê²° ê°€ëŠ¥"
        else
            echo "  âŒ $host:$port ($protocol) - ì—°ê²° ë¶ˆê°€"
        fi
    else
        echo "  nc ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"
    fi
}

test_port "127.0.0.1" "67" "udp"
test_port "localhost" "67" "udp"

# 7. ë¡œê·¸ í™•ì¸
echo -e "\nğŸ” ìµœê·¼ ì—ëŸ¬ ë¡œê·¸:"
if [ -f "/var/log/dhcp-test/server-error.log" ]; then
    tail -5 /var/log/dhcp-test/server-error.log
else
    echo "  ì—ëŸ¬ ë¡œê·¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ"
fi

echo -e "\n=== ì§„ë‹¨ ì™„ë£Œ ==="
```

#### ì„±ëŠ¥ ê´€ë ¨ ë¬¸ì œ
```bash
#!/bin/bash
# scripts/troubleshoot-performance.sh

echo "=== DHCP ì„±ëŠ¥ ë¬¸ì œ ì§„ë‹¨ ==="

# 1. ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸
echo "ğŸ” ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ :"
echo "CPU: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}')"
echo "ë©”ëª¨ë¦¬: $(free -h | grep Mem | awk '{print $3 "/" $2}')"
echo "ë””ìŠ¤í¬ I/O:"
iostat -x 1 1 2>/dev/null | tail -n +4 | head -5 || echo "  iostatë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ"

# 2. ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ í™•ì¸
echo -e "\nğŸ” ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½:"
if command -v iftop &> /dev/null; then
    echo "  iftopì´ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤. 'sudo iftop -i any -P' ë¡œ ì‹¤ì‹œê°„ í™•ì¸ ê°€ëŠ¥"
else
    echo "  ë„¤íŠ¸ì›Œí¬ í†µê³„ (ì¸í„°í˜ì´ìŠ¤ë³„):"
    cat /proc/net/dev | grep -E "eth|ens|wlan" | head -3
fi

# 3. í”„ë¡œì„¸ìŠ¤ë³„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
echo -e "\nğŸ” DHCP ê´€ë ¨ í”„ë¡œì„¸ìŠ¤ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰:"
ps aux | grep -E "dhcp" | grep -v grep | awk '{printf("PID: %s, CPU: %s%%, MEM: %s%%, CMD: %s\n", $2, $3, $4, $11)}'

# 4. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸
echo -e "\nğŸ” ë©”ëª¨ë¦¬ ì‚¬ìš© íŒ¨í„´ (5ì´ˆ ê°„ê²©ìœ¼ë¡œ 3íšŒ ì¸¡ì •):"
for i in {1..3}; do
    DHCP_PID=$(pgrep -f dhcp-server)
    if [ -n "$DHCP_PID" ]; then
        MEMORY_KB=$(ps -p "$DHCP_PID" -o rss= 2>/dev/null || echo "0")
        MEMORY_MB=$((MEMORY_KB / 1024))
        echo "  ì¸¡ì • $i: ${MEMORY_MB}MB"
    else
        echo "  ì¸¡ì • $i: í”„ë¡œì„¸ìŠ¤ ì—†ìŒ"
    fi
    [ $i -lt 3 ] && sleep 5
done

# 5. íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì‚¬ìš©ëŸ‰
echo -e "\nğŸ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì‚¬ìš©ëŸ‰:"
DHCP_PID=$(pgrep -f dhcp-server)
if [ -n "$DHCP_PID" ]; then
    FD_COUNT=$(ls -1 /proc/"$DHCP_PID"/fd 2>/dev/null | wc -l || echo "0")
    FD_LIMIT=$(cat /proc/"$DHCP_PID"/limits 2>/dev/null | grep "Max open files" | awk '{print $4}' || echo "unknown")
    echo "  ì‚¬ìš© ì¤‘: $FD_COUNT"
    echo "  ì œí•œ: $FD_LIMIT"
    
    if [ "$FD_COUNT" -gt 1000 ]; then
        echo "  âš ï¸ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ì‚¬ìš©ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤."
    fi
else
    echo "  DHCP í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"
fi

# 6. ë„¤íŠ¸ì›Œí¬ ë²„í¼ í™•ì¸
echo -e "\nğŸ” ë„¤íŠ¸ì›Œí¬ ë²„í¼ í¬ê¸°:"
echo "ìˆ˜ì‹  ë²„í¼: $(cat /proc/sys/net/core/rmem_default) / $(cat /proc/sys/net/core/rmem_max)"
echo "ì†¡ì‹  ë²„í¼: $(cat /proc/sys/net/core/wmem_default) / $(cat /proc/sys/net/core/wmem_max)"

# 7. ìµœê·¼ ì„±ëŠ¥ í†µê³„
echo -e "\nğŸ” ìµœê·¼ ì„±ëŠ¥ í†µê³„ (ë¡œê·¸ ê¸°ë°˜):"
if [ -f "/var/log/dhcp-test/tester.log" ]; then
    echo "ìµœê·¼ í…ŒìŠ¤íŠ¸ ê²°ê³¼:"
    grep -E "ì„±ê³µë¥ |í‰ê· .*ì‹œê°„|ì´ˆë‹¹.*ìˆ˜" /var/log/dhcp-test/tester.log | tail -5
else
    echo "  ì„±ëŠ¥ ë¡œê·¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"
fi

echo -e "\n=== ì„±ëŠ¥ ì§„ë‹¨ ì™„ë£Œ ==="
```

### 3.2 ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œì™€ í•´ê²°ì±…

#### ë¬¸ì œ 1: "Permission denied" ì—ëŸ¬
```bash
# ë¬¸ì œ ì§„ë‹¨
echo "=== Permission denied ë¬¸ì œ í•´ê²° ==="

# 1. í˜„ì¬ ê¶Œí•œ í™•ì¸
echo "í˜„ì¬ ì‚¬ìš©ì: $(whoami)"
echo "UID: $(id -u)"

# 2. í¬íŠ¸ 67/68ì€ ì¼ë°˜ì ìœ¼ë¡œ ê´€ë¦¬ì ê¶Œí•œ í•„ìš”
if [ "$(id -u)" -ne 0 ]; then
    echo "í•´ê²°ë°©ì•ˆ:"
    echo "1. sudoë¡œ ì‹¤í–‰: sudo ./dhcp-server"
    echo "2. ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©: ./dhcp-server -port 6700"
    echo "3. ê¶Œí•œ ì—†ì´ í…ŒìŠ¤íŠ¸: ./dhcp-tester -skip-priv-check"
fi

# 3. íŒŒì¼ ê¶Œí•œ í™•ì¸
echo -e "\níŒŒì¼ ê¶Œí•œ í™•ì¸:"
ls -l dhcp-server dhcp-tester 2>/dev/null || echo "ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ"
```

#### ë¬¸ì œ 2: "Address already in use" ì—ëŸ¬
```bash
# ë¬¸ì œ ì§„ë‹¨ ë° í•´ê²°
echo "=== í¬íŠ¸ ì‚¬ìš© ì¤‘ ë¬¸ì œ í•´ê²° ==="

# 1. í¬íŠ¸ 67ì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ ì°¾ê¸°
echo "í¬íŠ¸ 67ì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤:"
sudo lsof -i :67 2>/dev/null || netstat -ulnp | grep :67

# 2. DHCP ì„œë¹„ìŠ¤ í™•ì¸
echo -e "\nì‹œìŠ¤í…œ DHCP ì„œë¹„ìŠ¤ ìƒíƒœ:"
systemctl is-active dhcpd 2>/dev/null || echo "dhcpd ì„œë¹„ìŠ¤ ì—†ìŒ"
systemctl is-active isc-dhcp-server 2>/dev/null || echo "isc-dhcp-server ì„œë¹„ìŠ¤ ì—†ìŒ"

# 3. í•´ê²° ë°©ì•ˆ ì œì‹œ
echo -e "\ní•´ê²° ë°©ì•ˆ:"
echo "1. ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ: sudo kill \$(lsof -t -i:67)"
echo "2. ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©: ./dhcp-server -port 6700"
echo "3. ì‹œìŠ¤í…œ DHCP ì„œë¹„ìŠ¤ ì¤‘ì§€: sudo systemctl stop dhcpd"
```

#### ë¬¸ì œ 3: ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
echo "=== ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™” ==="

DHCP_PID=$(pgrep -f dhcp-server)
if [ -n "$DHCP_PID" ]; then
    MEMORY_MB=$(ps -p "$DHCP_PID" -o rss= | awk '{print int($1/1024)}')
    echo "í˜„ì¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${MEMORY_MB}MB"
    
    if [ "$MEMORY_MB" -gt 1024 ]; then
        echo "âš ï¸ ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì§€"
        echo "ê¶Œì¥ ì¡°ì¹˜:"
        echo "1. ë™ì‹œ í´ë¼ì´ì–¸íŠ¸ ìˆ˜ ì œí•œ: -concurrency 50"
        echo "2. IP í’€ í¬ê¸° ì¡°ì •"
        echo "3. ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ë‹¨ì¶•: -offer-timeout 10s"
        echo "4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘ ê³ ë ¤"
    fi
else
    echo "DHCP í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"
fi
```

### 3.3 ê³ ê¸‰ ë””ë²„ê¹…

#### ë„¤íŠ¸ì›Œí¬ íŒ¨í‚· ìº¡ì²˜
```bash
#!/bin/bash
# scripts/packet-capture.sh

INTERFACE="${1:-any}"
DURATION="${2:-60}"
OUTPUT_FILE="dhcp-capture-$(date +%Y%m%d_%H%M%S).pcap"

echo "=== DHCP íŒ¨í‚· ìº¡ì²˜ ì‹œì‘ ==="
echo "ì¸í„°í˜ì´ìŠ¤: $INTERFACE"
echo "ìº¡ì²˜ ì‹œê°„: ${DURATION}ì´ˆ"
echo "ì¶œë ¥ íŒŒì¼: $OUTPUT_FILE"

# tcpdumpë¥¼ ì‚¬ìš©í•œ íŒ¨í‚· ìº¡ì²˜
sudo tcpdump -i "$INTERFACE" -w "$OUTPUT_FILE" -s 0 \
    "port 67 or port 68" &
TCPDUMP_PID=$!

echo "íŒ¨í‚· ìº¡ì²˜ ì¤‘... (PID: $TCPDUMP_PID)"
echo "ì¤‘ë‹¨í•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”."

# ì§€ì •ëœ ì‹œê°„ í›„ ìë™ ì¢…ë£Œ
sleep "$DURATION"
sudo kill "$TCPDUMP_PID" 2>/dev/null

echo "íŒ¨í‚· ìº¡ì²˜ ì™„ë£Œ: $OUTPUT_FILE"
echo "ë¶„ì„ì„ ìœ„í•´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:"
echo "  tcpdump -r $OUTPUT_FILE"
echo "  wireshark $OUTPUT_FILE"

# ê°„ë‹¨í•œ í†µê³„ ì¶œë ¥
if [ -f "$OUTPUT_FILE" ]; then
    PACKET_COUNT=$(tcpdump -r "$OUTPUT_FILE" 2>/dev/null | wc -l)
    echo "ìº¡ì²˜ëœ íŒ¨í‚· ìˆ˜: $PACKET_COUNT"
fi
```

#### ìƒì„¸ ë¡œê·¸ ë¶„ì„
```bash
#!/bin/bash
# scripts/detailed-log-analysis.sh

LOG_FILE="${1:-/var/log/dhcp-test/server.log}"
OUTPUT_DIR="log-analysis-$(date +%Y%m%d_%H%M%S)"

echo "=== ìƒì„¸ ë¡œê·¸ ë¶„ì„ ==="
echo "ë¡œê·¸ íŒŒì¼: $LOG_FILE"
echo "ì¶œë ¥ ë””ë ‰í† ë¦¬: $OUTPUT_DIR"

mkdir -p "$OUTPUT_DIR"

# 1. ê¸°ë³¸ í†µê³„
echo "ğŸ“Š ê¸°ë³¸ í†µê³„ ìƒì„± ì¤‘..."
{
    echo "=== DHCP ë¡œê·¸ ë¶„ì„ ë³´ê³ ì„œ ==="
    echo "ë¶„ì„ ì‹œê°„: $(date)"
    echo "ë¡œê·¸ íŒŒì¼: $LOG_FILE"
    echo ""
    
    echo "1. ì „ì²´ í†µê³„"
    echo "ì´ ë¡œê·¸ ë¼ì¸ ìˆ˜: $(wc -l < "$LOG_FILE")"
    echo "ë¶„ì„ ê¸°ê°„: $(head -1 "$LOG_FILE" | awk '{print $1, $2}') ~ $(tail -1 "$LOG_FILE" | awk '{print $1, $2}')"
    echo ""
    
    echo "2. ë©”ì‹œì§€ íƒ€ì…ë³„ í†µê³„"
    grep -oE "(DISCOVER|OFFER|REQUEST|ACK|NAK)" "$LOG_FILE" | sort | uniq -c | sort -nr
    echo ""
    
    echo "3. ì—ëŸ¬ í†µê³„"
    grep -i "error\|fail\|timeout" "$LOG_FILE" | awk '{print $NF}' | sort | uniq -c | sort -nr
    echo ""
    
    echo "4. ì‹œê°„ëŒ€ë³„ í™œë™"
    awk '{print substr($2,1,2)}' "$LOG_FILE" | sort | uniq -c | sort -k2n
    
} > "$OUTPUT_DIR/basic-stats.txt"

# 2. ì—ëŸ¬ ìƒì„¸ ë¶„ì„
echo "âŒ ì—ëŸ¬ ìƒì„¸ ë¶„ì„ ì¤‘..."
grep -i "error\|fail\|timeout" "$LOG_FILE" > "$OUTPUT_DIR/errors.log"

# 3. í´ë¼ì´ì–¸íŠ¸ IP ë¶„í¬
echo "ğŸŒ í´ë¼ì´ì–¸íŠ¸ ë¶„ì„ ì¤‘..."
grep -oE "([0-9]{1,3}\.){3}[0-9]{1,3}" "$LOG_FILE" | sort | uniq -c | sort -nr > "$OUTPUT_DIR/client-ips.txt"

# 4. ì‹œê°„ë³„ íŠ¸ë˜í”½ ë¶„ì„
echo "ğŸ“ˆ ì‹œê°„ë³„ íŠ¸ë˜í”½ ë¶„ì„ ì¤‘..."
awk '{print $1 " " substr($2,1,5)}' "$LOG_FILE" | sort | uniq -c > "$OUTPUT_DIR/traffic-by-time.txt"

# 5. ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¶”ì¶œ
echo "âš¡ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¶”ì¶œ ì¤‘..."
{
    echo "=== ì„±ëŠ¥ ë©”íŠ¸ë¦­ ==="
    echo ""
    
    echo "ì²˜ë¦¬ ì‹œê°„ ë¶„í¬:"
    grep -oE "ì²˜ë¦¬ì‹œê°„: [0-9.]+[a-z]+" "$LOG_FILE" | sort | uniq -c
    echo ""
    
    echo "ì‘ë‹µ ì‹œê°„ ë¶„í¬:"
    grep -oE "ì‘ë‹µì‹œê°„: [0-9.]+[a-z]+" "$LOG_FILE" | sort | uniq -c
    
} > "$OUTPUT_DIR/performance-metrics.txt"

# 6. ë³´ì•ˆ ê´€ë ¨ ì´ë²¤íŠ¸
echo "ğŸ”’ ë³´ì•ˆ ì´ë²¤íŠ¸ ë¶„ì„ ì¤‘..."
grep -iE "unauthorized|invalid|malformed|attack" "$LOG_FILE" > "$OUTPUT_DIR/security-events.log"

# 7. ìš”ì•½ ë³´ê³ ì„œ ìƒì„±
echo "ğŸ“‹ ìš”ì•½ ë³´ê³ ì„œ ìƒì„± ì¤‘..."
{
    echo "=== ë¡œê·¸ ë¶„ì„ ìš”ì•½ ==="
    echo ""
    
    echo "ğŸ” ì£¼ìš” ë°œê²¬ì‚¬í•­:"
    
    # ì—ëŸ¬ìœ¨ ê³„ì‚°
    TOTAL_REQUESTS=$(grep -cE "(DISCOVER|REQUEST)" "$LOG_FILE")
    ERROR_COUNT=$(grep -ciE "error|fail|timeout" "$LOG_FILE")
    if [ "$TOTAL_REQUESTS" -gt 0 ]; then
        ERROR_RATE=$((ERROR_COUNT * 100 / TOTAL_REQUESTS))
        echo "- ì „ì²´ ì—ëŸ¬ìœ¨: ${ERROR_RATE}% (${ERROR_COUNT}/${TOTAL_REQUESTS})"
    fi
    
    # ê°€ì¥ ë§ì€ ì—ëŸ¬ ìœ í˜•
    TOP_ERROR=$(grep -i "error\|fail\|timeout" "$LOG_FILE" | awk '{print $NF}' | sort | uniq -c | sort -nr | head -1)
    echo "- ì£¼ìš” ì—ëŸ¬ ìœ í˜•: $TOP_ERROR"
    
    # í”¼í¬ ì‹œê°„ëŒ€
    PEAK_HOUR=$(awk '{print substr($2,1,2)}' "$LOG_FILE" | sort | uniq -c | sort -nr | head -1 | awk '{print $2}')
    echo "- í”¼í¬ ì‹œê°„ëŒ€: ${PEAK_HOUR}ì‹œ"
    
    echo ""
    echo "ğŸ“ ìƒì„¸ ë¶„ì„ íŒŒì¼:"
    echo "- ê¸°ë³¸ í†µê³„: basic-stats.txt"
    echo "- ì—ëŸ¬ ë¡œê·¸: errors.log"
    echo "- í´ë¼ì´ì–¸íŠ¸ IP: client-ips.txt"
    echo "- ì‹œê°„ë³„ íŠ¸ë˜í”½: traffic-by-time.txt"
    echo "- ì„±ëŠ¥ ë©”íŠ¸ë¦­: performance-metrics.txt"
    echo "- ë³´ì•ˆ ì´ë²¤íŠ¸: security-events.log"
    
} > "$OUTPUT_DIR/summary.txt"

echo "âœ… ë¡œê·¸ ë¶„ì„ ì™„ë£Œ"
echo "ê²°ê³¼ í™•ì¸: cat $OUTPUT_DIR/summary.txt"
```

## 4. ì„±ëŠ¥ ìµœì í™”

### 4.1 ì‹œìŠ¤í…œ íŠœë‹

#### ë„¤íŠ¸ì›Œí¬ ìµœì í™”
```bash
#!/bin/bash
# scripts/network-optimization.sh

echo "=== ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ìµœì í™” ==="

# í˜„ì¬ ì„¤ì • ë°±ì—…
cp /etc/sysctl.conf /etc/sysctl.conf.backup.$(date +%Y%m%d)

# ë„¤íŠ¸ì›Œí¬ ë²„í¼ í¬ê¸° ìµœì í™”
cat >> /etc/sysctl.conf << EOF

# DHCP ì„±ëŠ¥ ìµœì í™” ì„¤ì •
# ë„¤íŠ¸ì›Œí¬ ë²„í¼ í¬ê¸° ì¦ê°€
net.core.rmem_default = 262144
net.core.rmem_max = 16777216
net.core.wmem_default = 262144
net.core.wmem_max = 16777216

# UDP ë²„í¼ í¬ê¸° ì¦ê°€
net.core.netdev_max_backlog = 5000
net.core.netdev_budget = 300

# ì†Œì¼“ ì—°ê²° ìˆ˜ ì¦ê°€
net.core.somaxconn = 65536

# TIME_WAIT ì†Œì¼“ ì¬ì‚¬ìš©
net.ipv4.tcp_tw_reuse = 1

# íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ìˆ˜ ì¦ê°€
fs.file-max = 65536
EOF

# ì„¤ì • ì ìš©
sysctl -p

echo "ë„¤íŠ¸ì›Œí¬ ìµœì í™” ì ìš© ì™„ë£Œ"
```

#### í”„ë¡œì„¸ìŠ¤ ìµœì í™”
```bash
#!/bin/bash
# scripts/process-optimization.sh

echo "=== í”„ë¡œì„¸ìŠ¤ ìµœì í™” ==="

# 1. ulimit ì„¤ì • ìµœì í™”
echo "í˜„ì¬ ulimit ì„¤ì •:"
ulimit -a

# 2. systemd ì„œë¹„ìŠ¤ ìµœì í™”
cat > /etc/systemd/system/dhcp-test-optimized.service << EOF
[Unit]
Description=DHCP Test Server (Optimized)
After=network.target

[Service]
Type=simple
User=dhcp-test
Group=dhcp-test
WorkingDirectory=/opt/dhcp-test

# ì‹¤í–‰ ëª…ë ¹ì–´
ExecStart=/opt/dhcp-test/dhcp-server \\
  -listen 0.0.0.0 \\
  -port 67 \\
  -start-ip 192.168.100.10 \\
  -end-ip 192.168.100.250 \\
  -max-concurrent 5000 \\
  -response-delay 0ms

# ì„±ëŠ¥ ìµœì í™”
LimitNOFILE=65536
LimitNPROC=8192
LimitMEMLOCK=infinity

# CPU ì¹œí™”ì„± ì„¤ì • (ë©€í‹°ì½”ì–´ í™œìš©)
CPUAffinity=0-3

# ë©”ëª¨ë¦¬ ìµœì í™”
MemoryHigh=4G
MemoryMax=8G

# I/O ìš°ì„ ìˆœìœ„
IOSchedulingClass=1
IOSchedulingPriority=4

# ì¬ì‹œì‘ ì •ì±…
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
echo "ìµœì í™”ëœ ì„œë¹„ìŠ¤ ì„¤ì • ì™„ë£Œ"
```

### 4.2 ì• í”Œë¦¬ì¼€ì´ì…˜ íŠœë‹

#### Go ëŸ°íƒ€ì„ ìµœì í™”
```bash
#!/bin/bash
# scripts/go-runtime-optimization.sh

echo "=== Go ëŸ°íƒ€ì„ ìµœì í™” ==="

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cat > /etc/environment << EOF
# Go ëŸ°íƒ€ì„ ìµœì í™”
GOMAXPROCS=8
GOGC=100
GODEBUG=gctrace=0

# ë©”ëª¨ë¦¬ í• ë‹¹ ìµœì í™”
GOMEMLIMIT=4GiB
EOF

# systemd ì„œë¹„ìŠ¤ìš© í™˜ê²½ ë³€ìˆ˜
mkdir -p /etc/systemd/system/dhcp-test-server.service.d
cat > /etc/systemd/system/dhcp-test-server.service.d/optimization.conf << EOF
[Service]
Environment="GOMAXPROCS=8"
Environment="GOGC=100"
Environment="GOMEMLIMIT=4GiB"
EOF

systemctl daemon-reload
echo "Go ëŸ°íƒ€ì„ ìµœì í™” ì™„ë£Œ"
```

#### ë¹Œë“œ ìµœì í™”
```bash
#!/bin/bash
# scripts/optimized-build.sh

echo "=== ìµœì í™” ë¹Œë“œ ==="

# ì„±ëŠ¥ ìµœì í™” ë¹Œë“œ
echo "ì„±ëŠ¥ ìµœì í™” ë¹Œë“œ ì¤‘..."
go build -ldflags="-s -w" \
         -gcflags="-N -l" \
         -tags=netgo \
         -a \
         -o dhcp-tester-optimized \
         dhcp-tester.go

go build -ldflags="-s -w" \
         -gcflags="-N -l" \
         -tags=netgo \
         -a \
         -o dhcp-server-optimized \
         dhcp-server.go

# í”„ë¡œíŒŒì¼ ê¸°ë°˜ ìµœì í™” (PGO)
echo "í”„ë¡œíŒŒì¼ ë°ì´í„° ìˆ˜ì§‘ ì¤‘..."
./dhcp-server-optimized -live &
SERVER_PID=$!
sleep 5

# í”„ë¡œíŒŒì¼ ìˆ˜ì§‘ì„ ìœ„í•œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./dhcp-tester-optimized -server 127.0.0.1 -clients 1000 -concurrency 100

# í”„ë¡œíŒŒì¼ ë°ì´í„°ë¡œ ì¬ë¹Œë“œ
kill $SERVER_PID
echo "PGO ê¸°ë°˜ ì¬ë¹Œë“œ..."

# CPU í”„ë¡œíŒŒì¼ ìˆ˜ì§‘ í›„ ë¹Œë“œ (ì‹¤ì œë¡œëŠ” pprof ë°ì´í„° í•„ìš”)
go build -ldflags="-s -w" \
         -pgo=auto \
         -o dhcp-tester-pgo \
         dhcp-tester.go

echo "ìµœì í™” ë¹Œë“œ ì™„ë£Œ"
ls -lh dhcp-*-optimized dhcp-*-pgo
```

## 5. ë³´ì•ˆ ìš´ì˜

### 5.1 ì ‘ê·¼ ì œì–´

#### ë°©í™”ë²½ ê·œì¹™
```bash
#!/bin/bash
# scripts/firewall-setup.sh

echo "=== ë°©í™”ë²½ ë³´ì•ˆ ì„¤ì • ==="

# Ubuntu/Debian UFW ì„¤ì •
if command -v ufw &> /dev/null; then
    echo "UFW ë°©í™”ë²½ ì„¤ì • ì¤‘..."
    
    # ê¸°ë³¸ ì •ì±… ì„¤ì •
    ufw --force reset
    ufw default deny incoming
    ufw default allow outgoing
    
    # SSH ì ‘ê·¼ í—ˆìš© (ê´€ë¦¬ìš©)
    ufw allow ssh
    
    # DHCP í¬íŠ¸ í—ˆìš© (íŠ¹ì • ë„¤íŠ¸ì›Œí¬ë§Œ)
    ufw allow from 192.168.0.0/16 to any port 67 proto udp
    ufw allow from 192.168.0.0/16 to any port 68 proto udp
    ufw allow from 10.0.0.0/8 to any port 67 proto udp
    ufw allow from 10.0.0.0/8 to any port 68 proto udp
    
    # ëª¨ë‹ˆí„°ë§ í¬íŠ¸ (ë¡œì»¬ë§Œ)
    ufw allow from 127.0.0.1 to any port 8080 proto tcp
    
    ufw --force enable
    echo "UFW ì„¤ì • ì™„ë£Œ"

# CentOS/RHEL firewalld ì„¤ì •
elif command -v firewall-cmd &> /dev/null; then
    echo "firewalld ì„¤ì • ì¤‘..."
    
    # DHCP ì„œë¹„ìŠ¤ í—ˆìš©
    firewall-cmd --permanent --add-service=dhcp
    
    # íŠ¹ì • ì†ŒìŠ¤ì—ì„œë§Œ ì ‘ê·¼ í—ˆìš©
    firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.0.0/16" service name="dhcp" accept'
    firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="10.0.0.0/8" service name="dhcp" accept'
    
    firewall-cmd --reload
    echo "firewalld ì„¤ì • ì™„ë£Œ"

else
    echo "ì§€ì›ë˜ëŠ” ë°©í™”ë²½ ë„êµ¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
fi

# í˜„ì¬ ë°©í™”ë²½ ìƒíƒœ í‘œì‹œ
echo -e "\ní˜„ì¬ ë°©í™”ë²½ ê·œì¹™:"
if command -v ufw &> /dev/null; then
    ufw status numbered
elif command -v firewall-cmd &> /dev/null; then
    firewall-cmd --list-all
fi
```

### 5.2 ë³´ì•ˆ ëª¨ë‹ˆí„°ë§

#### ì¹¨ì… íƒì§€
```bash
#!/bin/bash
# scripts/intrusion-detection.sh

LOG_FILE="/var/log/dhcp-test/security.log"
ALERT_FILE="/var/log/dhcp-test/security-alerts.log"

log_security_event() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

check_suspicious_activity() {
    local dhcp_log="/var/log/dhcp-test/server.log"
    
    if [ ! -f "$dhcp_log" ]; then
        return
    fi
    
    # 1. ë¹„ì •ìƒì ì¸ ìš”ì²­ ë¹ˆë„ í™•ì¸
    log_security_event "=== ë³´ì•ˆ ê²€ì‚¬ ì‹œì‘ ==="
    
    # ìµœê·¼ 5ë¶„ê°„ ë™ì¼ í´ë¼ì´ì–¸íŠ¸ì˜ ê³¼ë„í•œ ìš”ì²­
    local recent_time=$(date -d '5 minutes ago' '+%Y-%m-%d %H:%M')
    local suspicious_clients=$(
        grep "$recent_time" "$dhcp_log" | \
        grep -oE "([0-9a-fA-F]{2}:){5}[0-9a-fA-F]{2}" | \
        sort | uniq -c | awk '$1 > 100 {print $2, $1}'
    )
    
    if [ -n "$suspicious_clients" ]; then
        log_security_event "âš ï¸ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í´ë¼ì´ì–¸íŠ¸ í™œë™ ê°ì§€:"
        echo "$suspicious_clients" | while read mac count; do
            log_security_event "  MAC: $mac, ìš”ì²­ ìˆ˜: $count"
        done
    fi
    
    # 2. ë¹„ì •ìƒì ì¸ DHCP ì˜µì…˜ í™•ì¸
    local malformed_packets=$(grep -c "malformed\|invalid option\|parsing error" "$dhcp_log" || echo "0")
    if [ "$malformed_packets" -gt 10 ]; then
        log_security_event "âš ï¸ ë¹„ì •ìƒ íŒ¨í‚· ê°ì§€: $malformed_packets ê°œ"
    fi
    
    # 3. IP ê³ ê°ˆ ê³µê²© íƒì§€
    local pool_exhaustion=$(grep -c "IP í’€ ê³ ê°ˆ\|pool exhausted" "$dhcp_log" || echo "0")
    if [ "$pool_exhaustion" -gt 5 ]; then
        log_security_event "ğŸš¨ IP í’€ ê³ ê°ˆ ê³µê²© ì˜ì‹¬: $pool_exhaustion íšŒ"
        echo "[$(date)] IP Pool Exhaustion Attack Detected" >> "$ALERT_FILE"
    fi
    
    log_security_event "=== ë³´ì•ˆ ê²€ì‚¬ ì™„ë£Œ ==="
}

# ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§
monitor_security() {
    echo "ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ì‹œì‘..."
    
    while true; do
        check_suspicious_activity
        sleep 300  # 5ë¶„ë§ˆë‹¤ í™•ì¸
    done
}

# ë©”ì¸ ì‹¤í–‰
case "${1:-monitor}" in
    "check")
        check_suspicious_activity
        ;;
    "monitor")
        monitor_security
        ;;
    *)
        echo "ì‚¬ìš©ë²•: $0 [check|monitor]"
        exit 1
        ;;
esac
```

### 5.3 ê°ì‚¬ ë¡œê·¸

#### ë³´ì•ˆ ê°ì‚¬ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# scripts/security-audit.sh

AUDIT_DIR="/var/log/dhcp-test/audit"
AUDIT_FILE="$AUDIT_DIR/security-audit-$(date +%Y%m%d).log"

mkdir -p "$AUDIT_DIR"

audit_log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$AUDIT_FILE"
}

security_audit() {
    audit_log "=== DHCP ì‹œìŠ¤í…œ ë³´ì•ˆ ê°ì‚¬ ì‹œì‘ ==="
    
    # 1. íŒŒì¼ ê¶Œí•œ ê²€ì‚¬
    audit_log "ğŸ“ íŒŒì¼ ê¶Œí•œ ê²€ì‚¬:"
    
    local critical_files=(
        "/opt/dhcp-test/dhcp-server"
        "/opt/dhcp-test/dhcp-tester"
        "/etc/systemd/system/dhcp-test-server.service"
        "/etc/dhcp-test/production.conf"
    )
    
    for file in "${critical_files[@]}"; do
        if [ -f "$file" ]; then
            local perms=$(ls -l "$file" | awk '{print $1, $3, $4}')
            audit_log "  $file: $perms"
            
            # ê¶Œí•œ ê²€ì¦
            if [[ "$file" == *".conf" ]] && [[ "$(ls -l "$file" | cut -c5-7)" != "---" ]]; then
                audit_log "  âš ï¸ ì„¤ì • íŒŒì¼ì— ê·¸ë£¹ ì½ê¸° ê¶Œí•œì´ ìˆìŠµë‹ˆë‹¤: $file"
            fi
        else
            audit_log "  âŒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: $file"
        fi
    done
    
    # 2. í”„ë¡œì„¸ìŠ¤ ê²€ì‚¬
    audit_log "ğŸ” í”„ë¡œì„¸ìŠ¤ ê²€ì‚¬:"
    local dhcp_processes=$(ps aux | grep -E "dhcp" | grep -v grep)
    if [ -n "$dhcp_processes" ]; then
        audit_log "  ì‹¤í–‰ ì¤‘ì¸ DHCP í”„ë¡œì„¸ìŠ¤:"
        echo "$dhcp_processes" | while read line; do
            audit_log "    $line"
        done
    else
        audit_log "  ì‹¤í–‰ ì¤‘ì¸ DHCP í”„ë¡œì„¸ìŠ¤ ì—†ìŒ"
    fi
    
    # 3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê²€ì‚¬
    audit_log "ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ê²€ì‚¬:"
    local network_connections=$(netstat -tulpn | grep -E ":67|:68")
    if [ -n "$network_connections" ]; then
        audit_log "  DHCP ê´€ë ¨ ë„¤íŠ¸ì›Œí¬ ì—°ê²°:"
        echo "$network_connections" | while read line; do
            audit_log "    $line"
        done
    fi
    
    # 4. ë¡œê·¸ íŒŒì¼ ë¬´ê²°ì„± ê²€ì‚¬
    audit_log "ğŸ“ ë¡œê·¸ íŒŒì¼ ë¬´ê²°ì„± ê²€ì‚¬:"
    local log_files=(
        "/var/log/dhcp-test/server.log"
        "/var/log/dhcp-test/server-error.log"
        "/var/log/dhcp-test/security.log"
    )
    
    for log_file in "${log_files[@]}"; do
        if [ -f "$log_file" ]; then
            local size=$(du -h "$log_file" | cut -f1)
            local last_modified=$(stat -c %y "$log_file" | cut -d. -f1)
            audit_log "  $log_file: í¬ê¸°=$size, ìˆ˜ì •=$last_modified"
        fi
    done
    
    # 5. ì‹œìŠ¤í…œ ë³´ì•ˆ ì„¤ì • ê²€ì‚¬
    audit_log "ğŸ”’ ì‹œìŠ¤í…œ ë³´ì•ˆ ì„¤ì •:"
    
    # ë°©í™”ë²½ ìƒíƒœ
    if command -v ufw &> /dev/null; then
        local ufw_status=$(ufw status | head -1)
        audit_log "  UFW ìƒíƒœ: $ufw_status"
    elif command -v firewall-cmd &> /dev/null; then
        local firewall_status=$(firewall-cmd --state)
        audit_log "  firewalld ìƒíƒœ: $firewall_status"
    fi
    
    # SELinux ìƒíƒœ (í•´ë‹¹ë˜ëŠ” ê²½ìš°)
    if command -v getenforce &> /dev/null; then
        local selinux_status=$(getenforce)
        audit_log "  SELinux ìƒíƒœ: $selinux_status"
    fi
    
    # 6. ìµœê·¼ ë³´ì•ˆ ì´ë²¤íŠ¸ ìš”ì•½
    audit_log "ğŸ“Š ìµœê·¼ ë³´ì•ˆ ì´ë²¤íŠ¸ ìš”ì•½ (24ì‹œê°„):"
    if [ -f "/var/log/dhcp-test/security.log" ]; then
        local security_events=$(grep "$(date -d '1 day ago' '+%Y-%m-%d')\|$(date '+%Y-%m-%d')" \
                               /var/log/dhcp-test/security.log | wc -l)
        audit_log "  ë³´ì•ˆ ì´ë²¤íŠ¸ ìˆ˜: $security_events"
        
        local alerts=$(grep "ğŸš¨\|ALERT" /var/log/dhcp-test/security.log | \
                      grep "$(date -d '1 day ago' '+%Y-%m-%d')\|$(date '+%Y-%m-%d')" | wc -l)
        audit_log "  ì‹¬ê°í•œ ì•Œë¦¼ ìˆ˜: $alerts"
    else
        audit_log "  ë³´ì•ˆ ë¡œê·¸ íŒŒì¼ ì—†ìŒ"
    fi
    
    audit_log "=== ë³´ì•ˆ ê°ì‚¬ ì™„ë£Œ ==="
}

# ë©”ì¸ ì‹¤í–‰
security_audit

echo "ë³´ì•ˆ ê°ì‚¬ ì™„ë£Œ. ê²°ê³¼: $AUDIT_FILE"
```

## 6. ë°±ì—… ë° ë³µêµ¬

### 6.1 ë°±ì—… ì „ëµ

#### ìë™ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# scripts/backup.sh

BACKUP_DIR="/var/backups/dhcp-test"
RETENTION_DAYS=30
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$BACKUP_DIR"

backup_logs() {
    echo "=== ë¡œê·¸ ë°±ì—… ==="
    
    local log_backup_dir="$BACKUP_DIR/logs/$DATE"
    mkdir -p "$log_backup_dir"
    
    # ë¡œê·¸ íŒŒì¼ ì••ì¶• ë°±ì—…
    if [ -d "/var/log/dhcp-test" ]; then
        tar -czf "$log_backup_dir/dhcp-logs-$DATE.tar.gz" \
            -C /var/log dhcp-test/
        echo "ë¡œê·¸ ë°±ì—… ì™„ë£Œ: $log_backup_dir/dhcp-logs-$DATE.tar.gz"
    fi
}

backup_config() {
    echo "=== ì„¤ì • ë°±ì—… ==="
    
    local config_backup_dir="$BACKUP_DIR/config/$DATE"
    mkdir -p "$config_backup_dir"
    
    # ì‹œìŠ¤í…œ ì„¤ì • íŒŒì¼
    local config_files=(
        "/etc/systemd/system/dhcp-test-server.service"
        "/etc/dhcp-test/"
        "/etc/logrotate.d/dhcp-test"
    )
    
    for config in "${config_files[@]}"; do
        if [ -e "$config" ]; then
            cp -r "$config" "$config_backup_dir/"
            echo "ì„¤ì • ë°±ì—…: $config"
        fi
    done
    
    # ì„¤ì • ì••ì¶•
    tar -czf "$config_backup_dir/../config-$DATE.tar.gz" \
        -C "$config_backup_dir" .
    rm -rf "$config_backup_dir"
}

backup_binaries() {
    echo "=== ë°”ì´ë„ˆë¦¬ ë°±ì—… ==="
    
    local binary_backup_dir="$BACKUP_DIR/binaries/$DATE"
    mkdir -p "$binary_backup_dir"
    
    # ì‹¤í–‰ íŒŒì¼ ë°±ì—…
    if [ -d "/opt/dhcp-test" ]; then
        cp -r /opt/dhcp-test/* "$binary_backup_dir/"
        
        # ì••ì¶•
        tar -czf "$binary_backup_dir/../binaries-$DATE.tar.gz" \
            -C "$binary_backup_dir" .
        rm -rf "$binary_backup_dir"
        echo "ë°”ì´ë„ˆë¦¬ ë°±ì—… ì™„ë£Œ"
    fi
}

cleanup_old_backups() {
    echo "=== ì˜¤ë˜ëœ ë°±ì—… ì •ë¦¬ ==="
    
    # 30ì¼ ì´ì „ ë°±ì—… ì‚­ì œ
    find "$BACKUP_DIR" -name "*.tar.gz" -mtime +$RETENTION_DAYS -delete
    find "$BACKUP_DIR" -type d -empty -delete
    
    echo "ì˜¤ë˜ëœ ë°±ì—… ì •ë¦¬ ì™„ë£Œ"
}

# ë©”ì¸ ë°±ì—… ì‹¤í–‰
main_backup() {
    echo "DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ë°±ì—… ì‹œì‘: $DATE"
    
    backup_logs
    backup_config
    backup_binaries
    cleanup_old_backups
    
    # ë°±ì—… ì™„ë£Œ ì•Œë¦¼
    local backup_size=$(du -sh "$BACKUP_DIR" | cut -f1)
    echo "ë°±ì—… ì™„ë£Œ: ì´ í¬ê¸° $backup_size"
    
    # ë°±ì—… ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
    echo "$DATE,logs,config,binaries" >> "$BACKUP_DIR/backup-index.csv"
}

main_backup
```

### 6.2 ë³µêµ¬ ì ˆì°¨

#### ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# scripts/restore.sh

BACKUP_DIR="/var/backups/dhcp-test"
RESTORE_DATE="$1"

if [ -z "$RESTORE_DATE" ]; then
    echo "ì‚¬ìš©ë²•: $0 <YYYYMMDD_HHMMSS>"
    echo ""
    echo "ì‚¬ìš© ê°€ëŠ¥í•œ ë°±ì—…:"
    ls -la "$BACKUP_DIR"/*/*.tar.gz | awk '{print $9}' | sort
    exit 1
fi

restore_config() {
    echo "=== ì„¤ì • ë³µêµ¬ ==="
    
    local config_file="$BACKUP_DIR/config/config-$RESTORE_DATE.tar.gz"
    
    if [ -f "$config_file" ]; then
        # í˜„ì¬ ì„¤ì • ë°±ì—…
        cp -r /etc/systemd/system/dhcp-test-server.service \
              /tmp/dhcp-config-backup-$(date +%s) 2>/dev/null || true
        
        # ì„¤ì • ë³µêµ¬
        tar -xzf "$config_file" -C /tmp/
        cp -r /tmp/dhcp-test-server.service /etc/systemd/system/ 2>/dev/null || true
        cp -r /tmp/dhcp-test/ /etc/ 2>/dev/null || true
        
        systemctl daemon-reload
        echo "ì„¤ì • ë³µêµ¬ ì™„ë£Œ"
    else
        echo "ì„¤ì • ë°±ì—… íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: $config_file"
    fi
}

restore_binaries() {
    echo "=== ë°”ì´ë„ˆë¦¬ ë³µêµ¬ ==="
    
    local binary_file="$BACKUP_DIR/binaries/binaries-$RESTORE_DATE.tar.gz"
    
    if [ -f "$binary_file" ]; then
        # ì„œë¹„ìŠ¤ ì¤‘ì§€
        systemctl stop dhcp-test-server 2>/dev/null || true
        
        # í˜„ì¬ ë°”ì´ë„ˆë¦¬ ë°±ì—…
        if [ -d "/opt/dhcp-test" ]; then
            mv /opt/dhcp-test "/opt/dhcp-test-backup-$(date +%s)"
        fi
        
        # ë°”ì´ë„ˆë¦¬ ë³µêµ¬
        mkdir -p /opt/dhcp-test
        tar -xzf "$binary_file" -C /opt/dhcp-test/
        chown -R dhcp-test:dhcp-test /opt/dhcp-test
        chmod +x /opt/dhcp-test/dhcp-*
        
        echo "ë°”ì´ë„ˆë¦¬ ë³µêµ¬ ì™„ë£Œ"
    else
        echo "ë°”ì´ë„ˆë¦¬ ë°±ì—… íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: $binary_file"
    fi
}

restore_logs() {
    echo "=== ë¡œê·¸ ë³µêµ¬ (ì„ íƒì ) ==="
    
    local log_file="$BACKUP_DIR/logs/$RESTORE_DATE/dhcp-logs-$RESTORE_DATE.tar.gz"
    
    if [ -f "$log_file" ]; then
        read -p "ë¡œê·¸ë„ ë³µêµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N): " -n 1 -r
        echo
        
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            # í˜„ì¬ ë¡œê·¸ ë°±ì—…
            if [ -d "/var/log/dhcp-test" ]; then
                mv /var/log/dhcp-test "/var/log/dhcp-test-backup-$(date +%s)"
            fi
            
            # ë¡œê·¸ ë³µêµ¬
            tar -xzf "$log_file" -C /var/log/
            chown -R dhcp-test:dhcp-test /var/log/dhcp-test
            
            echo "ë¡œê·¸ ë³µêµ¬ ì™„ë£Œ"
        fi
    else
        echo "ë¡œê·¸ ë°±ì—… íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: $log_file"
    fi
}

verify_restoration() {
    echo "=== ë³µêµ¬ ê²€ì¦ ==="
    
    # íŒŒì¼ ì¡´ì¬ í™•ì¸
    if [ -f "/opt/dhcp-test/dhcp-server" ]; then
        echo "âœ… DHCP ì„œë²„ ë°”ì´ë„ˆë¦¬ ì¡´ì¬"
    else
        echo "âŒ DHCP ì„œë²„ ë°”ì´ë„ˆë¦¬ ì—†ìŒ"
    fi
    
    if [ -f "/opt/dhcp-test/dhcp-tester" ]; then
        echo "âœ… DHCP í…ŒìŠ¤í„° ë°”ì´ë„ˆë¦¬ ì¡´ì¬"
    else
        echo "âŒ DHCP í…ŒìŠ¤í„° ë°”ì´ë„ˆë¦¬ ì—†ìŒ"
    fi
    
    if [ -f "/etc/systemd/system/dhcp-test-server.service" ]; then
        echo "âœ… systemd ì„œë¹„ìŠ¤ íŒŒì¼ ì¡´ì¬"
    else
        echo "âŒ systemd ì„œë¹„ìŠ¤ íŒŒì¼ ì—†ìŒ"
    fi
    
    # ì„œë¹„ìŠ¤ ì‹œì‘ í…ŒìŠ¤íŠ¸
    echo "ì„œë¹„ìŠ¤ ì‹œì‘ í…ŒìŠ¤íŠ¸ ì¤‘..."
    systemctl start dhcp-test-server
    sleep 3
    
    if systemctl is-active dhcp-test-server > /dev/null; then
        echo "âœ… ì„œë¹„ìŠ¤ ì •ìƒ ì‹œì‘ë¨"
    else
        echo "âŒ ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨"
        echo "ë¡œê·¸ í™•ì¸: journalctl -u dhcp-test-server"
    fi
}

# ë©”ì¸ ë³µêµ¬ ì‹¤í–‰
main_restore() {
    echo "DHCP í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ë³µêµ¬ ì‹œì‘: $RESTORE_DATE"
    
    restore_config
    restore_binaries
    restore_logs
    verify_restoration
    
    echo "ë³µêµ¬ ì™„ë£Œ"
}

main_restore
```

---

ì´ ìš´ì˜ ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œë¥¼ í†µí•´ DHCP ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì†”ë£¨ì…˜ì„ ì•ˆì •ì ìœ¼ë¡œ ìš´ì˜í•˜ê³ , ë¬¸ì œ ë°œìƒ ì‹œ ì‹ ì†í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.